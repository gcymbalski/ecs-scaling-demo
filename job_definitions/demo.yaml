- job-template:
    name: '{name}-{env}'
    project-type: pipeline
    view:
      - scaling-demo 
    dsl: |
        pipeline {{
          agent any
          stages {{
            stage('Build Cluster') {{
              steps {{
                checkout([$class: 'GitSCM', branches: [[name: '*/master']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[url: 'ssh://git@github.com/gcymbalski/ecs-scaling-demo']]])
                sh 'bundle'
                sh 'bundle exec rake cluster:init'
                sh 'bundle exec rake cluster:remote_artifacts'
                sh 'bundle exec rake cluster:build'
              }}
            }}
            stage('Test Cluster') {{
              steps {{
                sh 'bundle exec rake cluster:test'
              }}
            }}
            stage('Destroy Cluster') {{
              steps {{
                sh 'bundle exec rake cluster:terminate'
              }}
            }}
          }}
        }}

- project:
    name: scalingdemo
    env:
      - dev
    jobs:
      - '{name}-{env}'


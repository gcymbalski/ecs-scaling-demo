{
  "builders": [
    {
      "type": "docker",
      "image": "cluster/golang:0.1",
      "changes": ["EXPOSE 80", "CMD /sbin/my_init"],
      "pull": "false",
      "commit": true
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "inline": [
	"mkdir /backend && mkdir -p /etc/service/backend"
      ]
    },
    {
      "type": "file",
      "source": "../lib/trivial_service/backend/backend.go",
      "destination": "/backend/backend.go"
    },
    {
      "type": "file",
      "source": "service_definitions/backend.sh",
      "destination": "/etc/service/backend/run"
    },
    {
      "type": "shell",
      "inline": [
	". /etc/profile && cd /backend && go build backend.go && chmod +x /etc/service/backend/run"
      ]
    }
  ],
  "post-processors": [
    {
      "type": "docker-tag",
      "repository": "cluster/backend",
      "tag": "0.1"
    }
  ]
}
